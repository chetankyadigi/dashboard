<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Calisthenics Registrations</title>
    <!-- Include jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.12);
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #667eea;
        }

        .stat-card p {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1em;
        }

        .search-box input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .registrations-table {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-header {
            display: grid;
            grid-template-columns: 1fr 0.5fr 0.7fr 1fr 1.2fr 1fr 1.2fr;
            background: rgba(102, 126, 234, 0.2);
            padding: 15px 20px;
            font-weight: bold;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-row {
            display: grid;
            grid-template-columns: 1fr 0.5fr 0.7fr 1fr 1.2fr 1fr 1.2fr;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.3s;
            align-items: center;
        }

        .table-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
        }

        .badge-male {
            background: rgba(66, 153, 225, 0.2);
            color: #4299e1;
            border: 1px solid #4299e1;
        }

        .badge-female {
            background: rgba(236, 72, 153, 0.2);
            color: #ec4899;
            border: 1px solid #ec4899;
        }

        .badge-other {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid #8b5cf6;
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            opacity: 0.7;
        }

        .export-section {
            margin-top: 30px;
            text-align: center;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: linear-gradient(45deg, #10b981, #34d399);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .pdf-btn {
            background: linear-gradient(45deg, #ef4444, #f87171);
        }

        .pdf-btn:hover {
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            opacity: 0.7;
            font-size: 0.9em;
        }

        @media (max-width: 1200px) {
            .table-header, .table-row {
                grid-template-columns: 1fr 0.6fr 0.8fr 1fr 1fr 1fr;
            }
            .registrationId {
                display: none;
            }
        }

        @media (max-width: 900px) {
            .table-header, .table-row {
                grid-template-columns: 1fr 0.6fr 0.8fr 1fr 1fr;
            }
            .timestamp {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .table-header, .table-row {
                grid-template-columns: 1fr 0.6fr 1fr;
            }
            .phone, .email {
                display: none;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .export-section {
                flex-direction: column;
                align-items: center;
            }
            
            .export-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“Š Admin Dashboard</h1>
            <p>Davanagere Calisthenics Festival - Registration Management</p>
        </div>

        <div class="stats-cards">
            <div class="stat-card">
                <h3 id="totalRegistrations">0</h3>
                <p>Total Registrations</p>
            </div>
            <div class="stat-card">
                <h3 id="maleCount">0</h3>
                <p>Male Participants</p>
            </div>
            <div class="stat-card">
                <h3 id="femaleCount">0</h3>
                <p>Female Participants</p>
            </div>
            <div class="stat-card">
                <h3 id="otherCount">0</h3>
                <p>Other</p>
            </div>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search by name, email, or phone...">
            </div>
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="refreshData()">
                    ðŸ”„ Refresh
                </button>
            </div>
        </div>

        <div class="registrations-table">
            <div class="table-header">
                <div>Name</div>
                <div>Age</div>
                <div>Gender</div>
                <div>Phone</div>
                <div>Email</div>
                <div class="timestamp">Registration Date</div>
                <div class="registrationId">Registration ID</div>
            </div>
            <div id="registrationsContainer">
                <div class="loading">Loading registrations...</div>
            </div>
        </div>

        <div class="export-section">
            <button class="export-btn" onclick="exportToExcel()">
                ðŸ“Š Export to Excel
            </button>
            <button class="export-btn pdf-btn" onclick="exportToPDF()">
                ðŸ“„ Export to PDF
            </button>
        </div>

        <div class="footer">
            <p>Â© 2025 CaliOG Admin Panel | Last updated: <span id="lastUpdated">--</span></p>
            <p>Data stored securely in Firebase | Total entries: <span id="totalCount">0</span></p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA0AUu3UDOhfDM6WLYUgtnqfmofdyEYoVE",
            authDomain: "calisthanics-f3b4e.firebaseapp.com",
            databaseURL: "https://calisthanics-f3b4e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "calisthanics-f3b4e",
            storageBucket: "calisthanics-f3b4e.firebasestorage.app",
            messagingSenderId: "777003125528",
            appId: "1:777003125528:web:eb9fe6031987d6161f6c6d"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        let allRegistrations = [];

        // Load registrations
        function loadRegistrations() {
            const registrationsRef = ref(database, 'calisthenicsRegistrations');
            
            onValue(registrationsRef, (snapshot) => {
                const data = snapshot.val();
                allRegistrations = [];
                
                if (data) {
                    Object.keys(data).forEach(key => {
                        allRegistrations.push({
                            id: key,
                            ...data[key]
                        });
                    });
                    
                    // Sort by timestamp (newest first)
                    allRegistrations.sort((a, b) => 
                        new Date(b.timestamp || 0) - new Date(a.timestamp || 0)
                    );
                }
                
                updateStatistics();
                displayRegistrations(allRegistrations);
                updateLastUpdated();
            });
        }

        // Display registrations in table
        function displayRegistrations(registrations) {
            const container = document.getElementById('registrationsContainer');
            
            if (registrations.length === 0) {
                container.innerHTML = '<div class="no-data">No registrations found</div>';
                return;
            }
            
            let html = '';
            
            registrations.forEach(reg => {
                const genderClass = `badge-${reg.gender || 'other'}`;
                
                html += `
                    <div class="table-row">
                        <div><strong>${reg.name || 'N/A'}</strong></div>
                        <div>${reg.age || 'N/A'}</div>
                        <div><span class="badge ${genderClass}">${reg.gender || 'Other'}</span></div>
                        <div class="phone">${reg.phone || 'N/A'}</div>
                        <div class="email">${reg.email || 'N/A'}</div>
                        <div class="timestamp">${reg.registrationDate || 'N/A'}</div>
                        <div class="registrationId">${reg.registrationId || 'N/A'}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Update statistics
        function updateStatistics() {
            document.getElementById('totalRegistrations').textContent = allRegistrations.length;
            document.getElementById('totalCount').textContent = allRegistrations.length;
            
            const maleCount = allRegistrations.filter(r => r.gender === 'male').length;
            const femaleCount = allRegistrations.filter(r => r.gender === 'female').length;
            const otherCount = allRegistrations.filter(r => 
                !r.gender || r.gender === 'other' || !['male', 'female'].includes(r.gender)
            ).length;
            
            document.getElementById('maleCount').textContent = maleCount;
            document.getElementById('femaleCount').textContent = femaleCount;
            document.getElementById('otherCount').textContent = otherCount;
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            if (!searchTerm) {
                displayRegistrations(allRegistrations);
                return;
            }
            
            const filtered = allRegistrations.filter(reg => 
                (reg.name && reg.name.toLowerCase().includes(searchTerm)) ||
                (reg.email && reg.email.toLowerCase().includes(searchTerm)) ||
                (reg.phone && reg.phone.includes(searchTerm)) ||
                (reg.registrationId && reg.registrationId.toLowerCase().includes(searchTerm))
            );
            
            displayRegistrations(filtered);
        });

        // Export to Excel
        function exportToExcel() {
            if (allRegistrations.length === 0) {
                alert('No data to export');
                return;
            }
            
            let csv = 'Name,Age,Gender,Phone,Email,Registration Date,Registration ID\n';
            
            allRegistrations.forEach(reg => {
                csv += `"${reg.name || ''}",`;
                csv += `${reg.age || ''},`;
                csv += `${reg.gender || ''},`;
                csv += `${reg.phone || ''},`;
                csv += `${reg.email || ''},`;
                csv += `"${reg.registrationDate || ''}",`;
                csv += `${reg.registrationId || ''}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `calisthenics_registrations_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert(`Exported ${allRegistrations.length} registrations to CSV`);
        }

        // Export to PDF
        function exportToPDF() {
            if (allRegistrations.length === 0) {
                alert('No data to export');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            
            // Title
            doc.setFontSize(20);
            doc.setTextColor(40, 40, 40);
            doc.text('Calisthenics Festival Registrations', 14, 15);
            
            // Subtitle
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`Generated on: ${new Date().toLocaleDateString()} | Total Registrations: ${allRegistrations.length}`, 14, 22);
            
            // Statistics section
            const maleCount = allRegistrations.filter(r => r.gender === 'male').length;
            const femaleCount = allRegistrations.filter(r => r.gender === 'female').length;
            const otherCount = allRegistrations.filter(r => 
                !r.gender || r.gender === 'other' || !['male', 'female'].includes(r.gender)
            ).length;
            
            doc.setFontSize(10);
            doc.text(`Male: ${maleCount} | Female: ${femaleCount} | Other: ${otherCount}`, 14, 28);
            
            // Prepare table data
            const tableData = allRegistrations.map(reg => [
                reg.name || 'N/A',
                reg.age || 'N/A',
                reg.gender || 'Other',
                reg.phone || 'N/A',
                reg.email || 'N/A',
                reg.registrationDate || 'N/A',
                reg.registrationId || 'N/A'
            ]);
            
            // AutoTable configuration
            doc.autoTable({
                startY: 35,
                head: [['Name', 'Age', 'Gender', 'Phone', 'Email', 'Registration Date', 'Registration ID']],
                body: tableData,
                theme: 'striped',
                headStyles: {
                    fillColor: [102, 126, 234],
                    textColor: 255,
                    fontSize: 10,
                    fontStyle: 'bold'
                },
                styles: {
                    fontSize: 9,
                    cellPadding: 3
                },
                columnStyles: {
                    0: { cellWidth: 'auto' },
                    1: { cellWidth: 15 },
                    2: { cellWidth: 20 },
                    3: { cellWidth: 30 },
                    4: { cellWidth: 50 },
                    5: { cellWidth: 40 },
                    6: { cellWidth: 50 }
                },
                margin: { horizontal: 14 }
            });
            
            // Footer
            const finalY = doc.lastAutoTable.finalY || 50;
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text('Â© 2025 CaliOG Admin Panel - Calisthenics Festival', 14, finalY + 10);
            doc.text(`Page ${doc.internal.getNumberOfPages()}`, doc.internal.pageSize.width - 20, finalY + 10);
            
            // Save the PDF
            doc.save(`calisthenics_registrations_${new Date().toISOString().split('T')[0]}.pdf`);
            
            alert(`Exported ${allRegistrations.length} registrations to PDF`);
        }

        // Refresh data
        function refreshData() {
            loadRegistrations();
            alert('Data refreshed successfully');
        }

        // Update last updated time
        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = 
                now.toLocaleString('en-IN', { 
                    timeZone: 'Asia/Kolkata',
                    dateStyle: 'medium', 
                    timeStyle: 'medium' 
                });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadRegistrations();
        });
    </script>
</body>
</html>
